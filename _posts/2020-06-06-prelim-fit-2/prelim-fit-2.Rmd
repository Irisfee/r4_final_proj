---
title: "prelim-fit-2"
description: |
  In this post we used random forest to train the model
author:
  - name: Peeta Li
    url: https://example.com/norajones
date: 06-06-2020
output:
  distill::distill_article:
    self_contained: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE,
                      warning = FALSE,
                      cache = TRUE,
                      echo = TRUE)

library(tidyverse)
library(tidymodels)
library(baguette)
library(future)
library(rio)

library(vip)
library(rpart.plot)

theme_set(theme_minimal())
```

read in data 

```{r}
frl <- import("https://nces.ed.gov/ccd/Data/zip/ccd_sch_033_1718_l_1a_083118.zip",
              setclass = "tbl_df")  %>% 
  janitor::clean_names()  %>% 
  filter(st == "OR")  %>%
  select(ncessch, lunch_program, student_count)  %>% 
  mutate(student_count = replace_na(student_count, 0))  %>% 
  pivot_wider(names_from = lunch_program,
              values_from = student_count)  %>% 
  janitor::clean_names()  %>% 
  mutate(ncessch = as.double(ncessch))

stu_counts <- import("https://github.com/datalorax/ach-gap-variability/raw/master/data/achievement-gaps-geocoded.csv", setclass = "tbl_df")  %>% 
  filter(state == "OR" & year == 1718)  %>% 
  count(ncessch, wt = n)  %>% 
  mutate(ncessch = as.double(ncessch))

frl <- left_join(frl, stu_counts)

frl <- frl %>% 
    mutate(p_free_lunch = free_lunch_qualified/n,
          p_reduced_price = reduced_price_lunch_qualified/n)

# read in train.csv
math <- read_csv(here::here('data','train.csv')) %>%
  select(-classification) %>% sample_frac(.01)
# read in xlsx
sheets <- readxl::excel_sheets(here::here('data','fallmembershipreport_20192020.xlsx'))
ode_schools <- readxl::read_xlsx(here::here('data','fallmembershipreport_20192020.xlsx'), sheet = sheets[4])
ethnicities <- ode_schools %>% 
  select(attnd_schl_inst_id = `Attending School ID`,
         attnd_dist_inst_id = `Attending District Institution ID`,
         sch_name = `School Name`,
         contains('%')) %>%
  janitor::clean_names()

names(ethnicities) <- gsub('x2019_20_percent', 'p', names(ethnicities))
# join the two data sets
math <- left_join(math, ethnicities)


df <- math %>% 
    left_join(frl)

```






Distill is a publication format for scientific and technical writing, native to the web.

Learn more about using Distill at <https://rstudio.github.io/distill>.


